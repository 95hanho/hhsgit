<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sejong.hhsweb.talk.mapper.TalkMapper">
	<select id="selectTalkList" resultType="TalkSpace">
		select tsnum, enrolldate, participants, ifone
		from talkspace
		where participants like '%' #{userId} '%'
	</select>
	
	<select id="selectTalksList" resultMap="talkMap">
		select *
		from talk
		where tsnum = #{tsnum}
	</select>
	
	<resultMap type="Talk" id="talkMap">
		<id column="tnum" property="tnum"/>
		<result column="enrolldate" property="enrollDate"/>
		<result column="content" property="content"/>
		<result column="userid" property="userId"/>
		<result column="tsnum" property="tsnum"/>
		<result column="status" property="status"/>
	</resultMap>
	
	<insert id="insertTalkSpace">
		insert into talkspace(enrolldate, participants, ifone)
		values(now(), #{tmd}, 'Y')
	</insert>
	<insert id="insertTalkSpace2">
		insert into talkspace(enrolldate, participants, ifone)
		values(now(), #{tmd}, 'N')
	</insert>
	
	<select id="selectTsNum" resultType="_int">
		select tsnum
		from talkspace
		order by enrolldate desc limit 1
	</select>
	
	<insert id="insertTalk" parameterType="Talk">
		insert into talk(enrolldate, content, userid, tsnum)
		values(now(), #{content}, #{userId}, #{tsnum})
	</insert>
</mapper>